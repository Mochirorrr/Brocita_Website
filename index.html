<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brocita - Tahu Premium (Live Stock)</title>
    <meta name="description" content="Brocita menjual berbagai olahan tahu premium yang lezat, renyah, dan higienis.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- AOS Animation Library (CDN) -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES --- */
        :root {
            --primary-color: #FF8C00;
            --secondary-color: #FFD700;
            --accent-color: #D35400;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
            --bg-light: #FDFBF7;
            --white: #FFFFFF;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --shadow-sm: 0 4px 15px rgba(0,0,0,0.08);
            --radius: 16px;
            --header-height: 75px; 
        }

        /* --- RESET & BASIC --- */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html { scroll-behavior: smooth; } 
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: var(--header-height); 
        }

        h1, h2, h3, h4 { font-family: 'Fredoka', sans-serif; color: var(--text-dark); }
        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }
        img { max-width: 100%; display: block; }
        button { font-family: 'Poppins', sans-serif; }
        .hidden { display: none !important; }

        /* --- UTILITIES --- */
        .container {
            max-width: 1200px; 
            margin: 0 auto;
            padding: 0 20px;
        }
        .section-padding { padding: 80px 0; }
        .text-center { text-align: center; }
        
        /* Tombol */
        .btn {
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        @keyframes pulse-orange {
            0% { box-shadow: 0 0 0 0 rgba(255, 140, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 140, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 140, 0, 0); }
        }
        .btn-primary { animation: pulse-orange 2s infinite; }

        .btn-primary:hover { 
            background-color: var(--accent-color); 
            transform: translateY(-3px); 
        }
        
        .btn-block { width: 100%; }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        .btn-danger:hover { background-color: #c0392b; }
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }
        .btn-secondary:hover { background-color: #7f8c8d; }
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none !important;
            animation: none !important;
            box-shadow: none;
        }

        /* --- HEADER & NAVIGATION --- */
        header {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: var(--header-height);
            display: flex;
            align-items: center; 
            padding: 0 5px; 
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center; 
            width: 100%;
            height: 100%; 
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.6rem; 
            font-weight: 700;
            color: var(--primary-color);
            font-family: 'Fredoka', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            z-index: 1001;
            height: 100%; 
            cursor: default;
            user-select: none;
        }

        .nav-links {
            display: flex;
            gap: 35px;
            align-items: center; 
            height: 100%; 
        }

        .nav-links li {
            height: 100%;
            display: flex;
            align-items: center;
        }

        .nav-links a { 
            font-weight: 500; 
            font-size: 1rem; 
            color: var(--text-dark);
            transition: color 0.3s; 
            position: relative;
            padding: 5px 0;
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 3px;
            bottom: 0;
            left: 0;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
            border-radius: 2px;
        }
        
        .nav-links a:hover::after, .nav-links a.active::after { width: 100%; }
        .nav-links a:hover, .nav-links a.active { color: var(--primary-color); }

        .header-actions {
            display: flex;
            align-items: center; 
            gap: 15px;
            height: 100%; 
            z-index: 1001;
        }

        .cart-icon {
            position: relative;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 10px; 
            color: var(--text-dark);
            transition: transform 0.2s;
        }
        .cart-icon:active { transform: scale(0.9); }

        .cart-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--accent-color);
            color: var(--white);
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            border: 2px solid var(--white);
        }

        .hamburger { display: none; font-size: 1.5rem; cursor: pointer; color: var(--text-dark); padding: 10px;}

        /* --- HERO SECTION --- */
        .hero {
            position: relative;
            min-height: 90vh;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #fff8e1 0%, #ffffff 100%);
            overflow: hidden;
        }

        .hero .container {
            display: flex;
            align-items: center;
            width: 100%;
            flex-wrap: wrap;
        }

        .hero-content {
            flex: 1;
            min-width: 300px;
            padding-right: 50px;
            z-index: 2;
        }

        .hero h1 { font-size: 3.5rem; line-height: 1.2; margin-bottom: 25px; color: var(--text-dark); }
        .hero h1 span { color: var(--primary-color); display: inline-block; }
        .hero p { font-size: 1.1rem; color: var(--text-light); margin-bottom: 35px; max-width: 500px; }

        .hero-image { flex: 1; min-width: 300px; position: relative; display: flex; justify-content: center; }
        .hero-image img {
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            box-shadow: var(--shadow);
            max-width: 450px;
            animation: float 6s ease-in-out infinite;
            z-index: 2;
            border: 5px solid rgba(255, 255, 255, 0.5);
        }

        .blob { position: absolute; border-radius: 50%; z-index: 1; filter: blur(60px); opacity: 0.6; }
        .blob-1 { width: 300px; height: 300px; top: -50px; right: -50px; background: #FFE0B2; animation: moveBlob 10s infinite alternate; }
        .blob-2 { width: 200px; height: 200px; bottom: 50px; right: 100px; background: #FFCC80; animation: moveBlob 8s infinite alternate-reverse; }

        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(2deg); } }
        @keyframes moveBlob { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 50px); } }

        /* --- PRODUCTS --- */
        .section-title { text-align: center; margin-bottom: 50px; }
        .section-title h2 { font-size: 2.5rem; margin-bottom: 15px; }
        .section-title span { color: var(--primary-color); font-weight: 600; position: relative; display: inline-block; }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }

        .product-card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .product-card:hover { transform: translateY(-10px); box-shadow: var(--shadow); }

        .product-image { height: 200px; overflow: hidden; position: relative; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .product-card:hover .product-image img { transform: scale(1.1); }

        .product-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-title { font-size: 1.2rem; margin-bottom: 8px; font-weight: 700; }
        .product-desc { font-size: 0.9rem; color: var(--text-light); margin-bottom: 20px; flex-grow: 1; }
        
        .product-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .price { font-size: 1.1rem; font-weight: 700; color: var(--primary-color); }
        .stock-tag { font-size: 0.75rem; color: #999; display: block; margin-top: 2px; }
        .stock-tag.low-stock { color: #e67e22; font-weight: bold; }
        .stock-tag.out-of-stock { color: #c0392b; font-weight: bold; }

        .btn-add {
            background-color: var(--text-dark);
            color: var(--white);
            border: none;
            width: 40px; height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        @keyframes btnPop {
            0% { transform: scale(1); }
            50% { transform: scale(0.85); }
            100% { transform: scale(1); }
        }
        .btn-add.clicked { animation: btnPop 0.2s ease; }

        .btn-add:hover:not(:disabled) { background-color: var(--primary-color); transform: rotate(90deg); }
        .btn-add:active:not(:disabled) { transform: scale(0.9); }
        
        .btn-add:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* --- TESTIMONIALS --- */
        .testimonials { background: linear-gradient(135deg, #fff9c4 0%, #ffe082 100%); position: relative; }
        
        .testimonial-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        
        .testimonial-card {
            background: var(--white); padding: 30px; border-radius: var(--radius); box-shadow: var(--shadow-sm); position: relative;
        }
        .testimonial-card::before {
            content: '\f10d'; font-family: "Font Awesome 6 Free"; font-weight: 900;
            position: absolute; top: 20px; left: 20px; font-size: 3rem; color: rgba(255, 140, 0, 0.1);
        }
        .stars { color: #FFD700; margin-bottom: 15px; font-size: 1rem; }
        .quote { font-style: italic; font-size: 0.95rem; color: #555; margin-bottom: 20px; position: relative; z-index: 2;}

        /* --- FOOTER --- */
        footer { background-color: var(--text-dark); color: var(--white); padding: 60px 0 20px; font-size: 0.95rem; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 40px; }
        
        .social-icons a {
            display: inline-flex; width: 40px; height: 40px; background: rgba(255,255,255,0.1);
            align-items: center; justify-content: center; border-radius: 50%; margin-right: 10px; transition: all 0.3s;
        }
        .social-icons a:hover { background: var(--primary-color); transform: translateY(-5px); }
        .copyright { text-align: center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 25px; color: #aaa; font-size: 0.85rem; }

        /* --- CART SIDEBAR --- */
        .cart-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 2000;
            opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        .cart-overlay.open { opacity: 1; visibility: visible; }

        .cart-sidebar {
            position: fixed; top: 0; right: -400px; width: 380px; max-width: 90%; height: 100%;
            background: var(--white); z-index: 2001; padding: 30px; display: flex; flex-direction: column;
            transition: right 0.4s cubic-bezier(0.77, 0.2, 0.05, 1.0); box-shadow: -10px 0 30px rgba(0,0,0,0.1);
        }
        .cart-sidebar.open { right: 0; }

        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .cart-header h3 { font-size: 1.4rem; }
        .close-cart { cursor: pointer; font-size: 1.5rem; color: var(--text-light); transition: color 0.3s; }
        .close-cart:hover { color: var(--accent-color); }

        .cart-items { flex-grow: 1; overflow-y: auto; padding-right: 5px; margin-bottom: 20px; }
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 20px; background: #fafafa; padding: 15px; border-radius: 12px; border: 1px solid #eee; }
        .item-info h4 { font-size: 1rem; margin-bottom: 5px; }
        .item-info p { font-size: 0.9rem; color: var(--text-light); }
        .item-remove { color: #e74c3c; cursor: pointer; font-size: 0.8rem; margin-top: 8px; display: inline-block; font-weight: 600; }
        
        .cart-footer { padding-top: 20px; border-top: 1px solid #eee; }
        .total-price { display: flex; justify-content: space-between; font-weight: 700; font-size: 1.3rem; margin-bottom: 20px; color: var(--primary-color); }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.9rem; margin-bottom: 8px; font-weight: 600; color: var(--text-dark); }
        .form-group input, .form-group textarea {
            width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-family: inherit; transition: border 0.3s;
            background-color: #fcfcfc;
        }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); background-color: #fff; }
        .form-group textarea { resize: vertical; min-height: 60px; }

        /* --- MOBILE --- */
        @media (max-width: 768px) {
            :root { --header-height: 70px; }
            .logo { font-size: 1.4rem; }
            .nav-links {
                display: none; position: fixed; top: var(--header-height); left: 0; width: 100%; background-color: var(--white);
                flex-direction: column; padding: 25px 0; box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-top: 1px solid #eee; gap: 0; height: auto;
            }
            .nav-links li { width: 100%; text-align: center; border-bottom: 1px solid #f9f9f9; height: auto; display: block; }
            .nav-links a { display: block; padding: 15px 0; width: 100%; }
            .nav-links a::after { height: 4px; bottom: -2px; }
            .nav-links.active { display: flex; animation: slideDown 0.4s ease-out; }
            .hamburger { display: block; }
            .hero { flex-direction: column-reverse; text-align: center; background: var(--bg-light); padding: 100px 20px 60px; }
            .hero-content { padding-right: 0; margin-bottom: 50px; }
            .hero h1 { font-size: 2.5rem; }
            .hero p { margin: 0 auto 30px; }
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- TOAST & ALERT --- */
        .toast {
            visibility: hidden; min-width: 300px; background-color: var(--white); color: var(--text-dark);
            text-align: left; border-radius: 12px; padding: 16px 20px; position: fixed; z-index: 3000;
            left: 20px; bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border-left: 5px solid var(--primary-color); display: flex; align-items: center; gap: 15px;
            transform: translateX(-200%); transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @media (min-width: 769px) {
            .toast { left: 50%; transform: translateX(-50%) translateY(100px); bottom: 30px; border-left: none; border-top: 5px solid var(--primary-color); text-align: center; }
        }
        .toast.show { visibility: visible; transform: translateX(-50%) translateY(0); }
        @media (max-width: 768px) { .toast.show { transform: translateX(0); } }
        .toast-icon { font-size: 1.5rem; color: var(--primary-color); }
        .toast-content { flex-grow: 1; }
        .toast-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 2px; }
        .toast-message { font-size: 0.85rem; color: var(--text-light); }
        .toast-close { cursor: pointer; color: #aaa; font-size: 1rem; }

        .custom-alert-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(3px); z-index: 4000; opacity: 0; visibility: hidden; transition: all 0.3s;
            display: flex; justify-content: center; align-items: center;
        }
        .custom-alert-overlay.show { opacity: 1; visibility: visible; }
        .custom-alert-box {
            background: var(--white); padding: 30px; border-radius: 16px; width: 90%; max-width: 400px;
            text-align: center; transform: scale(0.8); transition: transform 0.3s; box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        .custom-alert-overlay.show .custom-alert-box { transform: scale(1); }
        .alert-icon { font-size: 3rem; color: var(--accent-color); margin-bottom: 20px; animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 50% { transform: translateX(10px); } 75% { transform: translateX(-10px); } }
        .alert-btn { background-color: var(--primary-color); color: var(--white); border: none; padding: 10px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-top:15px;}

        /* --- ADMIN DASHBOARD --- */
        .table-responsive { overflow-x: auto; background: white; border-radius: 12px; box-shadow: var(--shadow-sm); padding: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; font-weight: 600; color: var(--text-dark); }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #fff8e1; }
        .dashboard-stats { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-card { background: white; padding: 15px 25px; border-radius: 12px; box-shadow: var(--shadow-sm); flex: 1; min-width: 150px; }
        .stat-card h5 { color: var(--text-light); font-size: 0.9rem; margin-bottom: 5px; }
        .stat-card strong { font-size: 1.4rem; color: var(--primary-color); }

        /* --- PASSWORD MODAL --- */
        .password-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px); z-index: 5000; opacity: 0; visibility: hidden; transition: all 0.3s;
            display: flex; justify-content: center; align-items: center;
        }
        .password-modal.show { opacity: 1; visibility: visible; }
        .password-box {
            background: var(--white); padding: 40px; border-radius: 20px; width: 90%; max-width: 400px;
            text-align: center; transform: translateY(20px); transition: transform 0.3s; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .password-modal.show .password-box { transform: translateY(0); }
        .lock-icon { font-size: 3rem; color: var(--text-dark); margin-bottom: 20px; }
        .password-input {
            width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 10px;
            margin: 20px 0; text-align: center; font-family: monospace; transition: border 0.3s;
        }
        .password-input:focus { outline: none; border-color: var(--primary-color); }

        /* --- LOADING SPINNER --- */
        .loading-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.9);
            z-index: 6000; display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%;
            border-left-color: var(--primary-color); animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Connection Status Indicator */
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%; background-color: #ccc;
            display: inline-block; margin-left: 5px;
        }
        .status-dot.online { background-color: #27ae60; box-shadow: 0 0 5px #27ae60; }
        .status-dot.offline { background-color: #c0392b; }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <nav>
            <div class="logo" id="secretDoor">
                <i class="fas fa-utensils"></i> Brocita <span id="connStatus" class="status-dot"></span>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="#home" class="nav-link">Beranda</a></li>
                <li><a href="#products" class="nav-link">Menu</a></li>
                <li><a href="#testi" class="nav-link">Testimoni</a></li>
                <li><a href="#contact" class="nav-link">Kontak</a></li>
            </ul>
            <div class="header-actions">
                <div class="cart-icon" onclick="toggleCart()">
                    <i class="fas fa-shopping-basket"></i>
                    <span class="cart-badge" id="cartBadge">0</span>
                </div>
                <div class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </nav>
    </header>

    <!-- === VIEW PELANGGAN === -->
    <main id="customerView">
        <!-- Hero -->
        <section class="hero section-padding" id="home">
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
            <div class="container">
                <div class="hero-content">
                    <h1>Kerenyahan Tahu <br><span>Brocita</span> Tiada Tara!</h1>
                    <p>Tahu premium dengan tekstur lembut di dalam dan renyah di luar. Tanpa pengawet, hanya rasa cinta.</p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: inherit;">
                        <a href="#products" class="btn btn-primary">Pesan Sekarang</a>
                    </div>
                </div>
                <div class="hero-image">
                    <img src="Logo.png" alt="Tahu Goreng Brocita" onerror="this.src='https://picsum.photos/seed/tofu1/600/600'">
                </div>
            </div>
        </section>

        <!-- Products -->
        <section class="section-padding" id="products" style="background: var(--white);">
            <div class="container">
                <div class="section-title" data-aos="fade-up">
                    <h2>Menu <span>Populer</span></h2>
                    <div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-top:10px;">
                        <p style="color:var(--text-light)">Stok Real-time (Online).</p>
                        <button onclick="fetchCloudStock(true)" style="background:none; border:none; color:var(--primary-color); cursor:pointer; font-size:1.2rem;" title="Refresh Stok">
                            <i class="fas fa-sync-alt" id="refreshIcon"></i>
                        </button>
                    </div>
                </div>
                <div class="product-grid" id="productGrid">
                    <!-- JS will render products here -->
                    <div style="grid-column: 1/-1; text-align:center; padding: 50px;">
                        <i class="fas fa-spinner fa-spin" style="font-size:2rem; color:var(--primary-color);"></i>
                        <p style="margin-top:10px;">Mengambil data stok terbaru...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials -->
        <section class="section-padding testimonials" id="testi">
            <div class="container">
                <div class="section-title" data-aos="fade-up">
                    <h2>Kata <span>Pelanggan</span></h2>
                </div>
                <div class="testimonial-grid">
                    <div class="testimonial-card" data-aos="flip-left" data-aos-delay="0">
                        <div class="stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                        <p class="quote">"Bagi saya brocita memiliki banyak beragam makanan dan harganya juga terjangkau"</p>
                        <small style="font-weight:600; color:var(--primary-color)">- Fritzie</small>
                    </div>
                    <div class="testimonial-card" data-aos="flip-left" data-aos-delay="100">
                        <div class="stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                        <p class="quote">"brocita(brownies cireng tahu) menurut aku makanan yang ada di brocita ini enak² semua"</p>
                        <small style="font-weight:600; color:var(--primary-color)">- Marcello</small>
                    </div>
                    <div class="testimonial-card" data-aos="flip-left" data-aos-delay="200">
                        <div class="stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></div>
                        <p class="quote">"Bagi saya sudah cukup enak dan harga terjangkau, recommended!"</p>
                        <small style="font-weight:600; color:var(--primary-color)">- Kemas</small>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact -->
        <section class="section-padding" id="contact">
            <div class="container text-center">
                <div class="section-title" data-aos="fade-up">
                    <h2>Lokasi & <span>Kontak</span></h2>
                </div>
                <p style="margin-bottom: 30px; font-size:1.1rem;">Khusus Di Lingkungan Ignatius Global School Palembang.</p>
                <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;" data-aos="fade-up">
                    <div style="background:white; padding:15px 30px; border-radius:50px; box-shadow:var(--shadow-sm); display:flex; align-items:center; gap:10px;">
                        <i class="fas fa-map-marker-alt" style="color:var(--primary-color);"></i> Ignatius Global School
                    </div>
                    <div style="background:white; padding:15px 30px; border-radius:50px; box-shadow:var(--shadow-sm); display:flex; align-items:center; gap:10px;">
                        <i class="fas fa-phone" style="color:var(--primary-color);"></i> +62 838-9591-2388
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-grid">
                    <div data-aos="fade-right">
                        <h3 style="color:var(--primary-color); margin-bottom:15px; font-family:'Fredoka'; font-size:1.5rem;">Brocita</h3>
                        <p style="color:#ccc; font-size:0.9rem; line-height:1.8;">Menyajikan olahan tahu terbaik dengan bahan berkualitas dan cinta khas masakan rumahan. Renyah di luar, lembut di dalam.</p>
                    </div>
                    <div data-aos="fade-left">
                        <h4 style="color:white; margin-bottom:20px; font-size:1.2rem;">Ikuti Kami</h4>
                        <div class="social-icons">
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-whatsapp"></i></a>
                        </div>
                    </div>
                </div>
                <div class="copyright">
                    <span>&copy; 2023 Brocita Tahu Premium. All rights reserved.</span>
                </div>
            </div>
        </footer>
    </main>

    <!-- === VIEW ADMIN (DATABASE) === -->
    <main id="adminView" class="hidden">
        <section class="section-padding" id="dataDashboard" style="min-height: 100vh; background: #f4f6f8; padding-top: 40px;">
            <div class="container">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                    <h2 style="margin:0;"><i class="fas fa-lock"></i> Data Online (Private Mode)</h2>
                    <button onclick="switchView('customer')" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                </div>

                <!-- Stats -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h5>Total Pesanan</h5>
                        <strong id="totalOrdersCount">0</strong>
                    </div>
                    <div class="stat-card">
                        <h5>Total Pendapatan</h5>
                        <strong id="totalRevenue">Rp 0</strong>
                    </div>
                    <div class="stat-card" style="display:flex; align-items:center; justify-content:center; gap:10px;">
                        <span style="font-size:0.8rem; color:#27ae60; background:#eafaf1; padding:5px 10px; border-radius:20px;">
                            <i class="fas fa-shield-alt"></i> Secure Connection
                        </span>
                    </div>
                </div>

                <!-- Controls -->
                <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="loadAdminData()" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                    <button onclick="downloadCSV()" class="btn" style="background:#27ae60; color:white; box-shadow:0 4px 15px rgba(39,174,96,0.3);">
                        <i class="fas fa-file-csv"></i> Download CSV
                    </button>
                    <!-- Tombol Reset Pesanan (Diperbaiki) -->
                    <button onclick="resetOrdersData()" class="btn" style="background:#e74c3c; color:white; box-shadow:0 4px 15px rgba(231,76,60,0.3);">
                        <i class="fas fa-trash-alt"></i> Reset Pesanan (0)
                    </button>
                </div>

                <!-- Table -->
                <div class="table-responsive">
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>Waktu</th>
                                <th>Nama</th>
                                <th>Kelas</th>
                                <th>Catatan</th>
                                <th>Detail Pesanan</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- Data Render Here -->
                        </tbody>
                    </table>
                </div>
                
                <div id="emptyState" style="text-align:center; padding: 50px; color: #999; display: none;">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <p>Database kosong.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- UI COMPONENTS -->
    <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>Keranjang Saya</h3>
            <div class="close-cart" onclick="toggleCart()"><i class="fas fa-times"></i></div>
        </div>
        <div class="cart-items" id="cartItemsContainer">
            <p style="text-align:center; margin-top:50px; color:#aaa; font-style:italic;">Keranjang kosong...</p>
        </div>
        <div class="cart-footer">
            <div class="total-price"><span>Total:</span><span id="cartTotal">Rp 0</span></div>
            <div class="form-group">
                <label for="customerName">Nama Pemesan <span style="color:red">*</span></label>
                <input type="text" id="customerName" placeholder="Nama Kamu">
            </div>
            <div class="form-group">
                <label for="customerClass">Kelas <span style="color:red">*</span></label>
                <input type="text" id="customerClass" placeholder="Tulis kelas">
            </div>
            <div class="form-group">
                <label for="customerNote">Catatan Tambahan <small style="color:#999; font-weight:normal;">(Opsional)</small></label>
                <textarea id="customerNote" placeholder="Contoh: Req extra bumbu, dsb..."></textarea>
            </div>
            <button id="btnCheckout" class="btn btn-primary btn-block" onclick="processCheckout()">
                <i class="fab fa-whatsapp"></i> PESAN VIA WA
            </button>
            <div id="offlineMsg" style="display:none; text-align:center; color:#e74c3c; font-size:0.8rem; margin-top:5px;">
                <i class="fas fa-wifi"></i> Mode Offline (Tidak bisa pesan)
            </div>
        </div>
    </div>

    <div id="customToast" class="toast">
        <div class="toast-icon"><i class="fas fa-check-circle"></i></div>
        <div class="toast-content">
            <div class="toast-title">Berhasil!</div>
            <div class="toast-message" id="toastMessage">Action completed.</div>
        </div>
        <div class="toast-close" onclick="hideToast()"><i class="fas fa-times"></i></div>
    </div>

    <div id="customAlert" class="custom-alert-overlay">
        <div class="custom-alert-box">
            <div class="alert-icon"><i class="fas fa-exclamation-circle"></i></div>
            <div class="alert-title" id="alertTitle">Peringatan</div>
            <div class="alert-message" id="alertMessage">Pesan notifikasi disini.</div>
            <button class="alert-btn" onclick="hideAlert()">Mengerti</button>
        </div>
    </div>

    <div id="passwordModal" class="password-modal">
        <div class="password-box">
            <i class="fas fa-lock lock-icon"></i>
            <h3 style="margin-bottom:10px;">Admin Access (Private)</h3>
            <p style="color:var(--text-light); font-size:0.9rem;">Masukkan password admin.</p>
            <input type="password" id="adminPasswordInput" class="password-input" placeholder="****">
            <div class="password-actions" style="display:flex; gap:10px;">
                <button onclick="closePasswordModal()" class="btn btn-secondary" style="width:50%">Batal</button>
                <button onclick="checkPassword()" class="btn btn-primary" style="width:50%">Masuk</button>
            </div>
            <p style="margin-top:15px; font-size:0.75rem; color:#aaa;">Hint: Klik logo 5x.</p>
        </div>
    </div>

    <div id="loadingSpinner" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p style="margin-top:10px; font-weight:600; color:#555;">Memproses Data...</p>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({ once: true, offset: 100, duration: 800 });

        // ==========================================
        // ⚠️ KONFIGURASI PENTING (SUDAH DIISI)
        // ==========================================
        const DB_CONFIG = {
            // Bin ID dari database Brocita Anda
            binId: "696485e443b1c97be92a5519", 
            
            // Master Key dari database Brocita Anda
            masterKey: "$2a$10$eJTbvu.o.6SMCubYyK32A.jGZDi7Y/0ffV0V/7psvauWrwD689iJy", 
            
            // Password Admin UI
            uiPassword: "89898989" 
        };

        const ADMIN_WA = "6283895912388";

        // ==========================================
        // SISTEM PRODUK
        // ==========================================
        const DAILY_LIMIT = 10; // Stok awal reset otomatis

        const products = [
            { id: 1, name: "Tahu Ayam", price: 10000, img: "Tahu.jpeg", desc: "Tahu goreng isi ayam Brocita dibuat dari tahu pilihan dengan isian ayam yang lembut, gurih, dan berbumbu pas." },
            { id: 2, name: "Tahu Bakso", price: 10000, img: "Tahu.jpeg", desc: "Tahu Bakso Brocita hadir dengan tahu lembut berisi bakso padat, gurih, dan penuh rasa." },
            { id: 3, name: "Tahu Mix", price: 10000, img: "Tahu.jpeg", desc: "Tahu Mix Brocita berisi aneka isian pilihan yang gurih dan lezat, digoreng hingga crispy." },
            { id: 4, name: "Ayam Geprek", price: 20000, img: "Geprek.jpeg", desc: "Nasi ayam geprek Brocita disajikan dengan ayam goreng crispy yang digeprek sambal pedas khas." },
            { id: 5, name: "Chicken Steak", price: 20000, img: "Steak.jpeg", desc: "Nasi chicken steak Brocita disajikan dengan ayam steak lembut dan juicy, dilumuri saus spesial." },
        ];

        // State Aplikasi
        let cart = [];
        let isOnline = navigator.onLine;
        
        // ==========================================
        // API CLOUD HANDLER (JSONBIN)
        // ==========================================
        const getHeaders = () => {
            return {
                'Content-Type': 'application/json',
                'X-Master-Key': DB_CONFIG.masterKey
            };
        };

        // Helper: Cek hari ini (YYYY-MM-DD)
        function getTodayString() {
            return new Date().toISOString().split('T')[0];
        }

        // 1. Fetch Stok & Data Terbaru dari Cloud (REALTIME ONLY)
        async function fetchCloudStock(showLoading = false) {
            if(!DB_CONFIG.binId || DB_CONFIG.binId === "") {
                showCustomAlert("Error Sistem", "Bin ID belum dikonfigurasi.");
                return; 
            }

            if(showLoading) {
                document.getElementById('refreshIcon').classList.add('fa-spin');
            }

            try {
                // Fetch data langsung dari Server (Online Only)
                const response = await fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: getHeaders()
                });

                if (!response.ok) throw new Error('Gagal koneksi ke JSONBin Database');

                const data = await response.json();
                const db = data.record;

                // Update status online ke hijau
                setOnlineStatus(true);

                // === LOGIKA RESET OTOMATIS HARIAN ===
                // Jika tanggal di database berbeda dengan tanggal hari ini (User HP)
                // Maka stok di-reset ke DAILY_LIMIT dan tanggal diperbarui
                const today = getTodayString();
                if (db.lastResetDate !== today) {
                    console.log("Hari berganti! Mereset stok otomatis di Cloud...");
                    await resetCloudStockInternal();
                    // Setelah reset di cloud, fetch ulang data yang baru
                    return fetchCloudStock(showLoading); 
                }

                // === UPDATE STOK LOKAL ===
                // Update stok di variabel 'products' berdasarkan data dari cloud
                if(db.stock) {
                    products.forEach(p => {
                        p.currentStock = db.stock[p.id] !== undefined ? db.stock[p.id] : 0;
                    });
                }

                // Render ulang tampilan produk
                renderProducts();
                
                // Catat timestamp terakhir fetch (untuk referensi UI)
                console.log("Stok berhasil disinkronkan dari Cloud.");

            } catch (error) {
                console.error("Fetch Error:", error);
                // Jika gagal fetch, langsung matikan sistem agar tidak terjadi kesalahan data
                setOnlineStatus(false);
                showCustomAlert("Koneksi Terputus", "Gagal mengambil stok online. Harap periksa koneksi internet Anda.");
                
                // Tampilkan pesan error di grid produk
                const productGrid = document.getElementById('productGrid');
                productGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align:center; padding: 40px; color: #c0392b;">
                        <i class="fas fa-exclamation-triangle" style="font-size:3rem; margin-bottom:15px;"></i>
                        <h3>Offline / Gagal Koneksi</h3>
                        <p>Aplikasi ini membutuhkan koneksi internet aktif untuk menampilkan stok real-time.</p>
                        <button onclick="fetchCloudStock(true)" class="btn btn-primary" style="margin-top:20px;">Coba Lagi</button>
                    </div>`;
            } finally {
                if(showLoading) {
                    document.getElementById('refreshIcon').classList.remove('fa-spin');
                }
            }
        }

        // 2. Simpan Pesanan & Kurangi Stok (Transaksi Atomik)
        async function processCheckout() {
            if (cart.length === 0) return showCustomAlert("Ups!", "Keranjang kosong.");
            const name = document.getElementById('customerName').value;
            const cls = document.getElementById('customerClass').value;
            const note = document.getElementById('customerNote').value.trim();

            if (!name || !cls) return showCustomAlert("Lengkapi Data", "Isi Nama & Kelas dulu.");

            if(!isOnline) {
                return showCustomAlert("Offline Mode", "Maaf, Anda sedang offline. Pesanan tidak dapat diproses demi keakuratan stok.");
            }

            showLoading(true);

            try {
                // STEP 1: Ambil Data Terbaru (Locking Simulation)
                const res = await fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}/latest`, { headers: getHeaders() });
                if(!res.ok) throw new Error("Gagal mengunci data stok");
                const currentDB = await res.json();

                // STEP 2: Validasi Stok & Hitung Pengurangan
                let newStockState = { ...currentDB.record.stock };
                let itemsList = [];
                let total = 0;

                for (let item of cart) {
                    const currentStockInDB = newStockState[item.id] || 0;
                    if (currentStockInDB < item.qty) {
                        throw new Error(`Stok ${item.name} tidak cukup. Sisa di server: ${currentStockInDB}`);
                    }
                    // Kurangi stok
                    newStockState[item.id] = currentStockInDB - item.qty;
                    
                    // Hitung total
                    const sub = item.price * item.qty;
                    total += sub;
                    itemsList.push(`${item.name} (${item.qty})`);
                }

                // STEP 3: Siapkan Data Order Baru
                const newOrder = {
                    id: Date.now(),
                    date: new Date().toLocaleString('id-ID'),
                    name: name,
                    class: cls,
                    note: note || "-",
                    items: itemsList.join(', '),
                    total: total
                };

                // STEP 4: Update Database (Stock + Order)
                currentDB.record.stock = newStockState;
                if(!currentDB.record.orders) currentDB.record.orders = [];
                currentDB.record.orders.push(newOrder);

                // Kirim Update ke Cloud
                const updateRes = await fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: getHeaders(),
                    body: JSON.stringify(currentDB.record)
                });

                if(!updateRes.ok) throw new Error("Gagal menyimpan perubahan ke database.");

                // STEP 5: Jika Sukses -> Kirim WA & Update UI Lokal
                // Update local memory
                products.forEach(p => {
                    p.currentStock = newStockState[p.id];
                });

                // Kirim WA
                let msg = `Halo Admin Brocita, mau pesan:%0A%0ANama: ${name}%0AKelas: ${cls}%0A%0A*Pesanan:*%0A`;
                cart.forEach(item => {
                    msg += `- ${item.name} (${item.qty}x)%0A`;
                });
                if(note) msg += `%0A*Catatan:* ${note}`;
                msg += `%0A%0A*Total: Rp ${total.toLocaleString('id-ID')}*`;

                // Reset Cart & Buka WA
                cart = [];
                updateCartUI();
                toggleCart();
                renderProducts(); // Update tampilan stok di menu
                window.open(`https://wa.me/${ADMIN_WA}?text=${msg}`, '_blank');
                showToast("Pesanan Berhasil! Stok diperbarui.");

            } catch (error) {
                console.error(error);
                showCustomAlert("Gagal Pesan", error.message);
            } finally {
                showLoading(false);
            }
        }

        // 3. Reset Stok (Untuk Admin - Hanya dipanggil otomatis saat ganti hari)
        async function resetCloudStockInternal() {
            const resetStock = {};
            products.forEach(p => resetStock[p.id] = DAILY_LIMIT);

            const payload = {
                lastResetDate: getTodayString(),
                stock: resetStock,
                orders: [] 
            };

            await fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}`, {
                method: 'PUT',
                headers: getHeaders(),
                body: JSON.stringify(payload)
            });
        }

        // 4. FUNGSI BARU: Reset Pesanan Menjadi 0 (Manual Button Admin)
        // Ini yang Anda minta: Mengosongkan orders tapi menjaga stok tetap ada
        async function resetOrdersData() {
            if(!confirm("PERINGATAN: Apakah Anda yakin ingin menghapus SEMUA data pesanan menjadi kosong (0)? Data tidak bisa dikembalikan.")) return;
            
            showLoading(true);
            try {
                // 1. Ambil data terbaru dulu agar stok tidak hilang
                const res = await fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}/latest`, { headers: getHeaders() });
                if(!res.ok) throw new Error("Gagal mengambil data saat ini.");
                
                const currentDB = await res.json();

                // 2. Persiapkan update HANYA pada bagian 'orders'
                // Kita TIDAK mengubah 'stock' atau 'lastResetDate'
                currentDB.record.orders = []; // Kosongkan pesanan

                // 3. Kirim update kembali ke Cloud
                const updateRes = await fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: getHeaders(),
                    body: JSON.stringify(currentDB.record)
                });

                if(!updateRes.ok) throw new Error("Gagal mereset data pesanan.");

                // 4. Update UI Admin
                await loadAdminData();
                showToast("Data pesanan berhasil dikosongkan (Reset 0).");

            } catch (e) {
                console.error(e);
                showCustomAlert("Error", e.message);
            } finally {
                showLoading(false);
            }
        }

        // ==========================================
        // FUNGSI UI & RENDER
        // ==========================================
        
        function renderProducts() {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = ''; 

            products.forEach((p, i) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.setAttribute('data-aos', 'fade-up');
                card.setAttribute('data-aos-delay', i * 50);
                
                const isOutOfStock = p.currentStock <= 0;
                const isLowStock = p.currentStock > 0 && p.currentStock <= 5;
                
                const btnClass = isOutOfStock ? 'btn-add disabled' : 'btn-add';
                const btnIcon = isOutOfStock ? '<i class="fas fa-ban"></i>' : '<i class="fas fa-plus"></i>';
                const btnAction = isOutOfStock ? '' : `onclick="addToCart(event, ${p.id})" onmousedown="animateBtn(this)"`;
                
                let stockText = `Sisa: ${p.currentStock}`;
                let stockClass = "stock-tag";
                
                if(isOutOfStock) {
                    stockText = "HABIS";
                    stockClass += " out-of-stock";
                } else if (isLowStock) {
                    stockClass += " low-stock";
                }

                card.innerHTML = `
                    <div class="product-image"><img src="${p.img}" alt="${p.name}" onerror="this.src='https://picsum.photos/seed/tofu${p.id}/400/300'"></div>
                    <div class="product-info">
                        <h3 class="product-title">${p.name}</h3>
                        <p class="product-desc">${p.desc}</p>
                        <div class="product-footer">
                            <div>
                                <span class="price">Rp ${p.price.toLocaleString('id-ID')}</span>
                                <span class="${stockClass}">${stockText}</span>
                            </div>
                            <button class="${btnClass}" ${btnAction} id="btn-${p.id}">${btnIcon}</button>
                        </div>
                    </div>`;
                productGrid.appendChild(card);
            });
        }

        function animateBtn(btn) {
            btn.classList.remove('clicked');
            void btn.offsetWidth; 
            btn.classList.add('clicked');
        }

        function addToCart(event, id) {
            // Validasi stok lokal (sebagai UX cepat), validasi final saat checkout
            const p = products.find(x => x.id === id);
            if(p.currentStock <= 0) return showCustomAlert("Stok Habis", "Maaf, barang ini sudah habis.");

            const exist = cart.find(x => x.id === id);
            const currentQtyInCart = exist ? exist.qty : 0;
            
            if (currentQtyInCart + 1 > p.currentStock) {
                showCustomAlert("Stok Terbatas", `Maksimal pesan ${p.name} hanya ${p.currentStock}.`);
                return;
            }

            exist ? exist.qty++ : cart.push({ ...p, qty: 1 });
            updateCartUI();
            showToast(`"${p.name}" masuk keranjang.`);
        }

        function removeFromCart(id) {
            cart = cart.filter(x => x.id !== id);
            updateCartUI();
        }

        function updateCartUI() {
            const totalQty = cart.reduce((a, b) => a + b.qty, 0);
            document.getElementById('cartBadge').innerText = totalQty;
            const container = document.getElementById('cartItemsContainer');
            const totalEl = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                container.innerHTML = '<p style="text-align:center; margin-top:50px; color:#aaa;">Kosong...</p>';
                totalEl.innerText = 'Rp 0';
                return;
            }

            let html = '', totalPrice = 0;
            cart.forEach(item => {
                const sub = item.price * item.qty;
                totalPrice += sub;
                html += `
                    <div class="cart-item">
                        <div class="item-info">
                            HP4><h4>${item.name}</h4></h4>
                            <p>${item.qty} x Rp ${item.price.toLocaleString()}</p>
                            <span class="item-remove" onclick="removeFromCart(${item.id})">Hapus</span>
                        </div>
                        <div style="font-weight:bold;">Rp ${sub.toLocaleString()}</div>
                    </div>`;
            });
            container.innerHTML = html;
            totalEl.innerText = 'Rp ' + totalPrice.toLocaleString('id-ID');
        }

        function toggleCart() {
            document.getElementById('cartSidebar').classList.toggle('open');
            document.getElementById('cartOverlay').classList.toggle('open');
        }

        // ==========================================
        // ADMIN & UTILITIES
        // ==========================================
        async function loadAdminData() {
            const res = await fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}/latest`, { headers: getHeaders() });
            if(!res.ok) return;
            
            const data = await res.json();
            const orders = data.record.orders || [];
            
            const tbody = document.getElementById('ordersTableBody');
            const empty = document.getElementById('emptyState');
            const table = document.getElementById('ordersTable');
            
            document.getElementById('totalOrdersCount').innerText = orders.length;
            const revenue = orders.reduce((sum, o) => sum + (o.total || 0), 0);
            document.getElementById('totalRevenue').innerText = 'Rp ' + revenue.toLocaleString('id-ID');

            tbody.innerHTML = '';
            if (orders.length === 0) {
                table.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            empty.style.display = 'none';

            orders.reverse().forEach(o => {
                tbody.innerHTML += `
                    <tr>
                        <td><small>${o.date}</small></td>
                        <td><strong>${o.name}</strong></td>
                        <td>${o.class}</td>
                        <td><small style="color:var(--text-light);">${o.note || '-'}</small></td>
                        <td><small>${o.items}</small></td>
                        <td style="color:var(--primary-color); font-weight:bold;">Rp ${o.total.toLocaleString()}</td>
                    </tr>`;
            });
        }

        function downloadCSV() {
            fetch(`https://api.jsonbin.io/v3/b/${DB_CONFIG.binId}/latest`, { headers: getHeaders() })
            .then(res => res.json())
            .then(data => {
                const orders = data.record.orders || [];
                if(orders.length === 0) return alert("Tidak ada data.");
                let csv = "ID,Tanggal,Nama,Kelas,Catatan,Items,Total\n";
                orders.forEach(o => {
                    const safeNote = o.note ? `"${o.note.replace(/"/g, '""')}"` : "";
                    csv += `${o.id},"${o.date}","${o.name}","${o.class}",${safeNote},"${o.items}",${o.total}\n`;
                });
                const link = document.createElement("a");
                link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
                link.download = `Brocita_Report_${new Date().toISOString().slice(0,10)}.csv`;
                link.click();
            });
        }

        function switchView(view) {
            window.scrollTo(0,0);
            const cust = document.getElementById('customerView');
            const adm = document.getElementById('adminView');
            const cart = document.querySelector('.cart-icon');
            
            if(view === 'admin') {
                cust.classList.add('hidden'); adm.classList.remove('hidden'); cart.style.display = 'none';
                loadAdminData();
            } else {
                cust.classList.remove('hidden'); adm.classList.add('hidden'); cart.style.display = 'flex';
            }
        }

        function showLoading(show) {
            const el = document.getElementById("loadingSpinner");
            show ? el.classList.remove('hidden') : el.classList.add('hidden');
        }

        function showToast(msg) {
            const t = document.getElementById("customToast");
            document.getElementById("toastMessage").innerText = msg;
            t.classList.add("show");
            setTimeout(() => t.classList.remove("show"), 3000);
        }

        function showCustomAlert(title, msg) {
            document.getElementById("alertTitle").innerText = title;
            document.getElementById("alertMessage").innerText = msg;
            document.getElementById("customAlert").classList.add("show");
        }

        function hideAlert() { document.getElementById("customAlert").classList.remove("show"); }
        function hideToast() { document.getElementById("customToast").classList.remove("show"); }

        // --- SECRET DOOR ---
        let count = 0;
        let timer = null;
        document.getElementById('secretDoor').addEventListener('click', (e) => {
            e.preventDefault();
            count++;
            clearTimeout(timer);
            timer = setTimeout(() => count = 0, 500);
            if(count >= 5) {
                document.getElementById('adminPasswordInput').value = '';
                document.getElementById('passwordModal').classList.add('show');
                count = 0;
            }
        });

        function closePasswordModal() { document.getElementById("passwordModal").classList.remove("show"); }
        
        function checkPassword() {
            const input = document.getElementById('adminPasswordInput').value;
            if(input === DB_CONFIG.uiPassword) {
                closePasswordModal();
                switchView('admin');
                showToast("Login Admin Berhasil");
            } else {
                showCustomAlert("Akses Ditolak", "Password Salah!");
                document.getElementById('adminPasswordInput').value = '';
            }
        }

        // --- ONLINE/OFFLINE DETECTOR ---
        function setOnlineStatus(status) {
            isOnline = status;
            const dot = document.getElementById('connStatus');
            const btnCheckout = document.getElementById('btnCheckout');
            const offlineMsg = document.getElementById('offlineMsg');

            if(status) {
                dot.className = 'status-dot online';
                btnCheckout.disabled = false;
                btnCheckout.classList.remove('btn-secondary');
                btnCheckout.classList.add('btn-primary');
                offlineMsg.style.display = 'none';
            } else {
                dot.className = 'status-dot offline';
                btnCheckout.disabled = true;
                btnCheckout.classList.remove('btn-primary');
                btnCheckout.classList.add('btn-secondary');
                offlineMsg.style.display = 'block';
            }
        }

        window.addEventListener('online', () => {
            setOnlineStatus(true);
            fetchCloudStock(true); 
            showToast("Koneksi Internet Kembali");
        });

        window.addEventListener('offline', () => {
            setOnlineStatus(false);
            showCustomAlert("Offline", "Anda sedang offline. Data stok mungkin tidak akurat.");
        });

        // --- INIT ---
        fetchCloudStock(true);

        // --- NAV LOGIC ---
        const navLinks = document.querySelectorAll(".nav-link");
        const sections = document.querySelectorAll("section");
        const hamburger = document.getElementById('hamburger');
        const navContainer = document.getElementById('navLinks');

        function updateActiveNavLink() {
            if (document.getElementById('adminView').classList.contains('hidden') === false) return;
            let current = "";
            sections.forEach(section => {
                if(section.offsetParent !== null) {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= (sectionTop - 150)) {
                        current = section.getAttribute("id");
                    }
                }
            });
            navLinks.forEach(a => {
                a.classList.remove("active");
                if (a.getAttribute("href").includes(current)) a.classList.add("active");
            });
        }

        window.addEventListener("scroll", updateActiveNavLink);

        hamburger.addEventListener('click', () => {
            if (document.getElementById('adminView').classList.contains('hidden') === false) return;
            navContainer.classList.toggle('active');
            hamburger.querySelector('i').classList.toggle('fa-bars');
            hamburger.querySelector('i').classList.toggle('fa-times');
        });

        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                navContainer.classList.remove('active');
                hamburger.querySelector('i').classList.add('fa-bars');
                hamburger.querySelector('i').classList.remove('fa-times');
            });
        });

    </script>
</body>
</html>